{"ast":null,"code":"import _regeneratorRuntime from\"/Users/andrewsquier/sei/project/pasta-bar/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/andrewsquier/sei/project/pasta-bar/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import*as usersAPI from\"./users-api\";export function signUp(_x){return _signUp.apply(this,arguments);}function _signUp(){_signUp=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(userData){var token;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return usersAPI.signUp(userData);case 2:token=_context.sent;// return token\n//instead of returning the token\nlocalStorage.setItem(\"token\",token);return _context.abrupt(\"return\",getUser());case 5:case\"end\":return _context.stop();}},_callee);}));return _signUp.apply(this,arguments);}export function getToken(){//get token from localStorage\nvar token=localStorage.getItem(\"token\");if(!token)return null;//get token's payload, use string.split\nvar payload=token.split(\".\")[1];//JWT's are base64 encoded\n//need to decode it to make it useable \n//gives us a json user object\nvar decodedPayload=atob(payload);var parsedPayload=JSON.parse(decodedPayload);//JWT exp is expressed in seconds, not milliseconds, need to convert ( / 1000 below )\n//check if expired\nif(parsedPayload.exp<Date.now(0)/1000){//the token has expired, remove it\nlocalStorage.removeItem(\"token\");return null;}else{return token;}}export function getUser(){var token=getToken();if(token){var payload=token.split(\".\")[1];var decodedPayload=atob(payload);var parsedPayload=JSON.parse(decodedPayload);return parsedPayload.user;}else{return null;}}export function logOut(){localStorage.removeItem(\"token\");}export function login(_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(credentials){var token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return usersAPI.login(credentials);case 2:token=_context2.sent;//console.log(\"Token: \" + token)\n//save the token, return the user\nlocalStorage.setItem(\"token\",token);return _context2.abrupt(\"return\",getUser());case 5:case\"end\":return _context2.stop();}},_callee2);}));return _login.apply(this,arguments);}export function checkToken(){return usersAPI.checkToken().then(function(dateString){return new Date(dateString);});}","map":{"version":3,"names":["usersAPI","signUp","userData","token","localStorage","setItem","getUser","getToken","getItem","payload","split","decodedPayload","atob","parsedPayload","JSON","parse","exp","Date","now","removeItem","user","logOut","login","credentials","checkToken","then","dateString"],"sources":["/Users/andrewsquier/sei/project/pasta-bar/src/utilities/users-service.js"],"sourcesContent":["import * as usersAPI from \"./users-api\"\n\nexport async function signUp(userData) {\n    const token = await usersAPI.signUp(userData)\n   \n    // return token\n    //instead of returning the token\n    localStorage.setItem(\"token\", token)\n    return getUser()\n}\n\nexport function getToken() {\n    //get token from localStorage\n    const token = localStorage.getItem(\"token\")\n    if(!token) return null\n    //get token's payload, use string.split\n\n    const payload = token.split(\".\")[1]\n    //JWT's are base64 encoded\n    //need to decode it to make it useable \n    //gives us a json user object\n    const decodedPayload = atob(payload)\n\n    const parsedPayload = JSON.parse(decodedPayload)\n    //JWT exp is expressed in seconds, not milliseconds, need to convert ( / 1000 below )\n\n    //check if expired\n    if(parsedPayload.exp < Date.now(0) / 1000) {\n        //the token has expired, remove it\n        localStorage.removeItem(\"token\")\n        return null\n    } else {\n        return token\n    }\n}\n\nexport function getUser() {\n    const token = getToken()\n\n    if(token){\n        const payload = token.split(\".\")[1]\n        const decodedPayload = atob(payload)\n        const parsedPayload = JSON.parse(decodedPayload)\n        return parsedPayload.user\n    } else {\n        return null\n    }\n\n}\n\nexport function logOut() {\n    localStorage.removeItem(\"token\")\n}\n\nexport async function login(credentials) {\n    //call login from users-api\n    //should be creating a token by loggin in \n    const token = await usersAPI.login(credentials)\n\n   //console.log(\"Token: \" + token)\n\n    //save the token, return the user\n    localStorage.setItem(\"token\", token)\n    return getUser()\n}\n\nexport function checkToken() {\n    return usersAPI.checkToken()\n        .then(dateString => new Date(dateString))\n}\n"],"mappings":"8QAAA,MAAO,GAAKA,SAAQ,KAAM,aAAa,CAEvC,eAAsBC,OAAM,2CAO3B,qFAPM,iBAAsBC,QAAQ,mJACbF,SAAQ,CAACC,MAAM,CAACC,QAAQ,CAAC,QAAvCC,KAAK,eAEX;AACA;AACAC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEF,KAAK,CAAC,iCAC7BG,OAAO,EAAE,uDACnB,yCAED,MAAO,SAASC,SAAQ,EAAG,CACvB;AACA,GAAMJ,MAAK,CAAGC,YAAY,CAACI,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAG,CAACL,KAAK,CAAE,MAAO,KAAI,CACtB;AAEA,GAAMM,QAAO,CAAGN,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACnC;AACA;AACA;AACA,GAAMC,eAAc,CAAGC,IAAI,CAACH,OAAO,CAAC,CAEpC,GAAMI,cAAa,CAAGC,IAAI,CAACC,KAAK,CAACJ,cAAc,CAAC,CAChD;AAEA;AACA,GAAGE,aAAa,CAACG,GAAG,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAC,CAAG,IAAI,CAAE,CACvC;AACAd,YAAY,CAACe,UAAU,CAAC,OAAO,CAAC,CAChC,MAAO,KAAI,CACf,CAAC,IAAM,CACH,MAAOhB,MAAK,CAChB,CACJ,CAEA,MAAO,SAASG,QAAO,EAAG,CACtB,GAAMH,MAAK,CAAGI,QAAQ,EAAE,CAExB,GAAGJ,KAAK,CAAC,CACL,GAAMM,QAAO,CAAGN,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACnC,GAAMC,eAAc,CAAGC,IAAI,CAACH,OAAO,CAAC,CACpC,GAAMI,cAAa,CAAGC,IAAI,CAACC,KAAK,CAACJ,cAAc,CAAC,CAChD,MAAOE,cAAa,CAACO,IAAI,CAC7B,CAAC,IAAM,CACH,MAAO,KAAI,CACf,CAEJ,CAEA,MAAO,SAASC,OAAM,EAAG,CACrBjB,YAAY,CAACe,UAAU,CAAC,OAAO,CAAC,CACpC,CAEA,eAAsBG,MAAK,2CAU1B,mFAVM,kBAAqBC,WAAW,wJAGfvB,SAAQ,CAACsB,KAAK,CAACC,WAAW,CAAC,QAAzCpB,KAAK,gBAEZ;AAEC;AACAC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEF,KAAK,CAAC,kCAC7BG,OAAO,EAAE,yDACnB,wCAED,MAAO,SAASkB,WAAU,EAAG,CACzB,MAAOxB,SAAQ,CAACwB,UAAU,EAAE,CACvBC,IAAI,CAAC,SAAAC,UAAU,QAAI,IAAIT,KAAI,CAACS,UAAU,CAAC,GAAC,CACjD"},"metadata":{},"sourceType":"module","externalDependencies":[]}